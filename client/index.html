<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì˜¨ë¼ì¸ ë©”ëª¨ë¦¬ ê²Œì„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

<style>
body { margin:0; font-family:Arial; background:#111; color:#fff; }
button,input,select { padding:8px; margin:4px; border-radius:6px; }
.screen { display:none; padding:20px; }
.active { display:block; }
.room { background:#222; padding:10px; margin:6px 0; border-radius:8px; cursor:pointer; }
.card { background:#444; height:80px; display:flex; align-items:center; justify-content:center;
        font-size:26px; border-radius:10px; cursor:pointer; }
.card.open { background:#fff; color:#000; }
.card.removed { visibility:hidden; }
#board { display:grid; grid-template-columns:repeat(auto-fill,minmax(60px,1fr)); gap:10px; }
.player { background:#222; padding:6px 10px; border-radius:6px; font-size:13px; }
</style>
</head>

<body>

<div id="main" class="screen active">
  <h1>ğŸ§  ë©”ëª¨ë¦¬ ê²Œì„</h1>

  <input id="nick" placeholder="ë‹‰ë„¤ì„">
  <button onclick="saveNick()">ì €ì¥</button>

  <h3>ë°© ë§Œë“¤ê¸°</h3>
  <input id="roomTitle" placeholder="ë°© ì œëª©">
  <select id="roomMode">
    <option value="number">ìˆ«ì</option>
    <option value="emoji">ì´ëª¨ì§€</option>
  </select>
  <select id="roomMax">
    <option>2</option><option>3</option><option>4</option><option>5</option>
  </select>
  <button onclick="createRoom()">ë°© ìƒì„±</button>

  <h3>ë°© ëª©ë¡</h3>
  <div id="rooms"></div>
</div>

<div id="game" class="screen">
  <h2 id="title"></h2>
  <div id="players"></div>
  <div id="turn"></div>
  <button id="startBtn" style="display:none" onclick="startGame()">ê²Œì„ ì‹œì‘</button>
  <div id="board"></div>
</div>

<script>
const socket = io('https://memorygame-hg6s.onrender.com');

let nickname = localStorage.getItem('nick') || '';
let roomId = null;
let myId = null;

document.getElementById('nick').value = nickname;

const sndFlip = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3');
const sndOk   = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3');
const sndFail = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3');

function saveNick(){
  nickname = document.getElementById('nick').value;
  localStorage.setItem('nick', nickname);
}

socket.on('connect', ()=> {
  myId = socket.id;
  socket.emit('requestRoomList');
});

function createRoom(){
  socket.emit('createRoom',{
    nickname,
    title: roomTitle.value,
    maxPlayers: Number(roomMax.value),
    mode: roomMode.value
  });
}

socket.on('roomList', list=>{
  rooms.innerHTML='';
  list.forEach(r=>{
    const d=document.createElement('div');
    d.className='room';
    d.textContent=`${r.title} (${r.players}/${r.max}) [${r.mode}]`;
    d.onclick=()=>socket.emit('joinRoom',{roomId:r.id,nickname});
    rooms.appendChild(d);
  });
});

socket.on('joinedRoom', room=>{
  roomId = room.id;
  main.classList.remove('active');
  game.classList.add('active');
  title.textContent = room.title;
  render(room);

  if(room.host === myId){
    startBtn.style.display='block';
  }
});

function startGame(){
  socket.emit('startGame',{roomId});
}

socket.on('gameStarted', room=>{
  render(room);
});

socket.on('update', room=>{
  render(room);
});

function render(room){
  players.innerHTML='';
  room.players.forEach(p=>{
    players.innerHTML+=`<div class='player'>${p.name}: ${p.score}</div>`;
  });
  turn.textContent = `í„´ ${room.turn}`;

  board.innerHTML='';
  room.cards.forEach((c,i)=>{
    const d=document.createElement('div');
    d.className='card';
    if(c.open) d.classList.add('open');
    if(c.removed) d.classList.add('removed');
    d.textContent = c.open ? c.value : '';
    d.onclick=()=>{ sndFlip.play(); socket.emit('flipCard',{roomId,index:i}); };
    board.appendChild(d);
  });
}
</script>
</body>
</html>
